<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Jarvis Asistente de Voz</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Orbitron', sans-serif;
      background: #000000; /* Fondo negro */
      color: #00ffff;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      text-align: center;
    }

    #header-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 2em;
    }
    
    #logo-svg {
      width: 150px;
      height: 150px;
      margin-bottom: 1em;
      filter: drop-shadow(0 0 15px #00ffff) drop-shadow(0 0 30px #00ffff);
      animation: logo-pulse 2s infinite alternate;
    }

    /* Estilos espec√≠ficos para la esfera luminosa */
    .glowing-sphere {
      fill: radial-gradient(circle at 50% 50%, #00ffff, #0077ff, #0000ff);
      stroke: #00ffff;
      stroke-width: 2px;
      filter: url(#glow); /* Aplicar filtro de brillo */
    }

    @keyframes logo-pulse {
      0% { transform: scale(1); filter: drop-shadow(0 0 10px #00ffff); }
      100% { transform: scale(1.1); filter: drop-shadow(0 0 25px #00ffff); }
    }
    
    h1 {
      font-size: 2.8em;
      margin-bottom: 0.5em;
      color: #00ffff;
      text-shadow: 0 0 20px #00ffff, 0 0 40px #00ffff;
    }

    #estado, #error {
      font-size: 1.2em;
      margin-top: 1em;
      color: #ffffff;
      text-shadow: 0 0 5px #00ffff;
    }
    
    canvas {
      position: absolute;
      top: 0;
      left: 0;
      z-index: -1;
      filter: blur(0.5px);
    }
    
  </style>
</head>
<body>
  <div id="header-container">
    <svg id="logo-svg" viewBox="0 0 200 200">
      <defs>
        <filter id="glow">
          <feGaussianBlur in="SourceGraphic" stdDeviation="5" result="blur" />
          <feMerge>
            <feMergeNode in="blur" />
            <feMergeNode in="SourceGraphic" />
          </feMerge>
        </filter>
        <radialGradient id="sphereGradient" cx="50%" cy="50%" r="50%" fx="50%" fy="50%">
            <stop offset="0%" style="stop-color:rgb(0,255,255);stop-opacity:1" />
            <stop offset="70%" style="stop-color:rgb(0,119,255);stop-opacity:1" />
            <stop offset="100%" style="stop-color:rgb(0,0,255);stop-opacity:1" />
        </radialGradient>
      </defs>
      <circle cx="100" cy="100" r="80" fill="url(#sphereGradient)" stroke="#00ffff" stroke-width="2" filter="url(#glow)"/>
    </svg>
    <h1>J.A.R.V.I.S</h1>
  </div>
  
  <div id="estado">‚è≥ Iniciando...</div>
  <div id="error"></div>
  <canvas id="fondo"></canvas>

  <script>
    const estadoDiv = document.getElementById("estado");
    const errorDiv = document.getElementById("error");
    let reconocimiento;
    let isSpeaking = false;

    function hablar(texto) {
      isSpeaking = true;
      const voz = new SpeechSynthesisUtterance(texto);
      voz.lang = "es-ES";
      voz.pitch = 0.9;
      voz.rate = 0.92;

      const seleccionarVoz = () => {
        const voces = window.speechSynthesis.getVoices();
        const vozElegida = voces.find(v => v.name.toLowerCase().includes("google espa√±ol")) ||
                               voces.find(v => v.name.toLowerCase().includes("pablo")) ||
                               voces.find(v => v.lang === 'es-ES' && v.name.toLowerCase().includes("male")) ||
                               voces.find(v => v.lang === 'es-ES');
        if (vozElegida) {
          voz.voice = vozElegida;
        }
      };

      if (speechSynthesis.getVoices().length === 0) {
        window.speechSynthesis.onvoiceschanged = seleccionarVoz;
      } else {
        seleccionarVoz();
      }

      speechSynthesis.speak(voz);
      voz.onend = () => {
        isSpeaking = false;
        if (estadoDiv.textContent !== "üí§ Jarvis se ha apagado.") {
            reconocimiento.start();
        }
      };
    }

    async function procesarComando(texto) {
      const textoNormalizado = texto.toLowerCase().trim();

      if (textoNormalizado.includes("jarvis apagar")) {
        hablar("Ha sido un placer servirle. Jarvis se apaga.");
        estadoDiv.textContent = "üí§ Jarvis se ha apagado.";
        if (reconocimiento) {
            reconocimiento.stop();
        }
        return;
      }

      estadoDiv.textContent = "üß† Jarvis est√° pensando...";

      try {
        const apiKey = "AIzaSyAS_N-kiSDdKqCiHrDE1q68H83vFgkeyJY";
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
        
        const payload = {
          contents: [{ parts: [{ text: textoNormalizado }] }],
          tools: [{ "google_search": {} }],
          systemInstruction: {
            parts: [{ text: "Act√∫a como un asistente de voz llamado Jarvis. S√© conciso, √∫til y responde en espa√±ol. Utiliza un tono profesional y educado, como un asistente personal avanzado. Responde a cualquier pregunta que te hagan sobre cualquier tema. Si te preguntan sobre el tiempo o la fecha, proporciona la informaci√≥n actual. No menciones tu programaci√≥n ni que eres un modelo de lenguaje." }]
          },
        };

        const response = await fetch(apiUrl, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        if (!response.ok) {
          throw new Error(`Error en la API: ${response.statusText}`);
        }

        const result = await response.json();
        const generatedText = result?.candidates?.[0]?.content?.parts?.[0]?.text;
        
        if (generatedText) {
          estadoDiv.textContent = `üó£Ô∏è He escuchado: "${texto}"`;
          hablar(generatedText);
        } else {
          estadoDiv.textContent = `‚ö†Ô∏è No se pudo obtener una respuesta.`;
          hablar("Lo siento, no pude procesar su solicitud en este momento. Int√©ntelo de nuevo m√°s tarde.");
        }
      } catch (error) {
        console.error("Error al llamar a la API:", error);
        errorDiv.textContent = `‚ö†Ô∏è Error de conexi√≥n: ${error.message}`;
        hablar("Ha ocurrido un error al intentar conectarme. Por favor, revise su conexi√≥n a internet.");
      }
    }

    function iniciarReconocimiento() {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

      if (!SpeechRecognition) {
        estadoDiv.textContent = "‚ùå Su navegador no soporta el reconocimiento de voz.";
        errorDiv.textContent = "Utilice Google Chrome o Microsoft Edge.";
        hablar("Me temo que su navegador no es compatible. Le recomiendo utilizar Google Chrome o Microsoft Edge.");
        return;
      }

      reconocimiento = new SpeechRecognition();
      reconocimiento.lang = "es-ES";
      reconocimiento.interimResults = false;
      reconocimiento.continuous = false;

      reconocimiento.onstart = () => {
        estadoDiv.textContent = "üéôÔ∏è Jarvis est√° a la espera de sus √≥rdenes...";
        errorDiv.textContent = "";
      };

      reconocimiento.onresult = (event) => {
        const texto = event.results[0][0].transcript;
        procesarComando(texto);
      };

      reconocimiento.onerror = (event) => {
        errorDiv.textContent = `‚ö†Ô∏è Error: ${event.error}. Reiniciando en 2 segundos...`;
        setTimeout(() => {
          if (estadoDiv.textContent !== "üí§ Jarvis se ha apagado.") {
              reconocimiento.start();
          }
        }, 2000);
      };

      reconocimiento.onend = () => {
        if (!isSpeaking && estadoDiv.textContent !== "üí§ Jarvis se ha apagado.") {
          reconocimiento.start();
        }
      };

      reconocimiento.start();
    }

    function iniciarParticulas() {
      const canvas = document.getElementById("fondo");
      const ctx = canvas.getContext("2d");
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;

      const particulas = Array.from({ length: 300 }, () => ({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height,
        r: Math.random() * 1.5 + 1,
        dx: (Math.random() - 0.5) * 0.7,
        dy: (Math.random() - 0.5) * 0.7
      }));

      function animar() {
        requestAnimationFrame(animar);
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        particulas.forEach(p => {
          p.x += p.dx;
          p.y += p.dy;

          if (p.x < 0 || p.x > canvas.width) p.dx *= -1;
          if (p.y < 0 || p.y > canvas.height) p.dy *= -1;

          ctx.beginPath();
          ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
          ctx.fillStyle = '#00ffff';
          ctx.fill();

          particulas.forEach(p2 => {
            const dist = Math.sqrt(Math.pow(p.x - p2.x, 2) + Math.pow(p.y - p2.y, 2));
            if (dist < 100) {
              ctx.beginPath();
              ctx.strokeStyle = `rgba(0, 255, 255, ${1 - dist / 100})`;
              ctx.lineWidth = 0.5;
              ctx.moveTo(p.x, p.y);
              ctx.lineTo(p2.x, p2.y);
              ctx.stroke();
            }
          });
        });
      }

      window.addEventListener('resize', () => {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      });

      animar();
    }

    window.onload = () => {
      hablar("Jarvis activado. Estoy listo se√±or .");
      iniciarReconocimiento();
      iniciarParticulas();
    };
  </script>
</body>
</html>